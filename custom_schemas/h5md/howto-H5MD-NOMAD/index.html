
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NOMAD Documentation for Computational data.
">
      
      
        <meta name="author" content="FAIRmat consortium">
      
      
      
        <link rel="prev" href="../../overview/">
      
      
        <link rel="next" href="../explanation-H5MD-NOMAD/">
      
      
      <link rel="icon" href="../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.5">
    
    
      
        <title>How-to - Work with H5MD-NOMAD - NOMAD Documentation: Computational Calculations</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Titillium Web";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-work-with-the-h5md-nomad-schema" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="NOMAD Documentation: Computational Calculations" class="md-header__button md-logo" aria-label="NOMAD Documentation: Computational Calculations" data-md-component="logo">
      
  <img src="../../../assets/nomad-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NOMAD Documentation: Computational Calculations
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How-to - Work with H5MD-NOMAD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/FAIRmat-NFDI/AreaC-DOC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="NOMAD Documentation: Computational Calculations" class="md-nav__button md-logo" aria-label="NOMAD Documentation: Computational Calculations" data-md-component="logo">
      
  <img src="../../../assets/nomad-logo.png" alt="logo">

    </a>
    NOMAD Documentation: Computational Calculations
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FAIRmat-NFDI/AreaC-DOC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Uploading and Publishing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Uploading and Publishing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../uploading_and_publishing/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../uploading_and_publishing/howto_upload_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-to upload data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../uploading_and_publishing/howto_publish_data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How-to publish data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../uploading_and_publishing/explanation_how_the_processing_works/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation - how the processing works?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../uploading_and_publishing/refs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Filtering and Querying
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Filtering and Querying
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../filtering_and_querying/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Custom schemas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Custom schemas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    H5MD-NOMAD
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            H5MD-NOMAD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    How-to - Work with H5MD-NOMAD
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    How-to - Work with H5MD-NOMAD
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python" class="md-nav__link">
    Writing an HDF5 file according to H5MD-NOMAD with python
  </a>
  
    <nav class="md-nav" aria-label="Writing an HDF5 file according to H5MD-NOMAD with python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-data" class="md-nav__link">
    Example Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h5md-group" class="md-nav__link">
    H5MD Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#particles-group" class="md-nav__link">
    Particles Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectivity-group" class="md-nav__link">
    Connectivity Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observables-group" class="md-nav__link">
    Observables Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-group" class="md-nav__link">
    Parameter Group
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-an-h5md-nomad-file" class="md-nav__link">
    Accessing an H5MD-NOMAD file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-topology-particles_group" class="md-nav__link">
    Creating a topology (particles_group)
  </a>
  
    <nav class="md-nav" aria-label="Creating a topology (particles_group)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-topology-structure-for-bonded-force-fields" class="md-nav__link">
    Standard topology structure for bonded force fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-standard-hierarchy-from-an-mdanalysis-universe" class="md-nav__link">
    Creating the standard hierarchy from an MDAnalysis universe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-topology-to-an-h5md-nomad-file" class="md-nav__link">
    Writing the topology to an H5MD-NOMAD file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../explanation-H5MD-NOMAD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation - File structure and schema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../reference-H5MD-NOMAD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference - H5MD-NOMAD
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Writing a parser plugin
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Writing a parser plugin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/parser_plugin_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/parser_shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating the framework for your parser
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/computational/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parser structure for computation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/parser_tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating parser tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/creating_new_metainfo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating new metainfo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    References
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/quick_parser_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start - parser setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/quick_installing_nomad_dev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start - installing a development version of NOMAD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/quick_NOMAD_best_practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start - best practices for NOMAD development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/examples_parser_matching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples - NOMAD's parser-matching interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/examples_populating_archive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples - populating the NOMAD archive
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/standard_workflows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard workflows in NOMAD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/advanced_new_parser_project/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced - creating a new parser project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../writing_a_parser_plugin/references/old_docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Old Docs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Normalizing metadata
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Normalizing metadata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../normalizing_metadata/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Customizing the filters
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Customizing the filters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../customizing_the_filters/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Visualizing properties
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visualizing properties
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../visualizing_properties/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Current and planned features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Current and planned features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../current_and_planned_features/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary/glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary of terms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python" class="md-nav__link">
    Writing an HDF5 file according to H5MD-NOMAD with python
  </a>
  
    <nav class="md-nav" aria-label="Writing an HDF5 file according to H5MD-NOMAD with python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-data" class="md-nav__link">
    Example Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h5md-group" class="md-nav__link">
    H5MD Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#particles-group" class="md-nav__link">
    Particles Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connectivity-group" class="md-nav__link">
    Connectivity Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observables-group" class="md-nav__link">
    Observables Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-group" class="md-nav__link">
    Parameter Group
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#accessing-an-h5md-nomad-file" class="md-nav__link">
    Accessing an H5MD-NOMAD file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-topology-particles_group" class="md-nav__link">
    Creating a topology (particles_group)
  </a>
  
    <nav class="md-nav" aria-label="Creating a topology (particles_group)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-topology-structure-for-bonded-force-fields" class="md-nav__link">
    Standard topology structure for bonded force fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-standard-hierarchy-from-an-mdanalysis-universe" class="md-nav__link">
    Creating the standard hierarchy from an MDAnalysis universe
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-the-topology-to-an-h5md-nomad-file" class="md-nav__link">
    Writing the topology to an H5MD-NOMAD file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="how-to-work-with-the-h5md-nomad-schema">How to work with the H5MD-NOMAD schema<a class="headerlink" href="#how-to-work-with-the-h5md-nomad-schema" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#how-to-work-with-the-h5md-nomad-schema">How to work with the H5MD-NOMAD schema</a><ul>
<li><a href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python">Writing an HDF5 file according to H5MD-NOMAD with python</a><ul>
<li><a href="#imports">Imports</a></li>
<li><a href="#example-data">Example Data</a></li>
<li><a href="#h5md-group">H5MD Group</a></li>
<li><a href="#particles-group">Particles Group</a></li>
<li><a href="#connectivity-group">Connectivity Group</a></li>
<li><a href="#observables-group">Observables Group</a></li>
<li><a href="#parameter-group">Parameter Group</a></li>
</ul>
</li>
<li><a href="#accessing-an-h5md-nomad-file">Accessing an H5MD-NOMAD file</a></li>
<li><a href="#creating-a-topology-particles_group">Creating a topology (particles_group)</a><ul>
<li><a href="#standard-topology-structure-for-bonded-force-fields">Standard topology structure for bonded force fields</a></li>
<li><a href="#creating-the-standard-hierarchy-from-an-mdanalysis-universe">Creating the standard hierarchy from an MDAnalysis universe</a></li>
<li><a href="#writing-the-topology-to-an-h5md-nomad-file">Writing the topology to an H5MD-NOMAD file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="writing-an-hdf5-file-according-to-h5md-nomad-with-python">Writing an HDF5 file according to H5MD-NOMAD with python<a class="headerlink" href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python" title="Permanent link">&para;</a></h2>
<p>You can write to an HDF5 file via a python interface, using the <a href="https://docs.h5py.org/en/stable/quick.html">h5py</a> package. This section walks you through the creation of each section of the H5MD-NOMAD schema, using practical examples to help you get started.</p>
<h3 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">h5py</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">parmed</span> <span class="k">as</span> <span class="nn">chem</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">import</span> <span class="nn">MDAnalysis</span> <span class="k">as</span> <span class="nn">mda</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
</code></pre></div>
<p><a href="https://docs.h5py.org/en/stable/quick.html">h5py</a>
: module for reading and writing HDF5 files.</p>
<p><a href="https://pint.readthedocs.io/en/0.10.1/tutorial.html">UnitRegistry</a>
: object from the <a href="https://pint.readthedocs.io/en/stable/">pint</a> package that provides assistance for working with units. We suggest using this package for easiest compatibility with NOMAD. If you have <code>nomad-lab</code> installed, you can alternatively import <code>ureg</code> with <code>from nomad.units import ureg</code>.</p>
<p><a href="https://www.mdanalysis.org/">MDAnalysis</a>
: a library to analyze trajectories from molecular dynamics simulations stored in various formats.</p>
<p><a href="https://parmed.github.io/ParmEd/html/index.html">ParmEd</a>
: a tool for aiding in investigations of biomolecular systems using popular molecular simulation packages.</p>
<h3 id="example-data">Example Data<a class="headerlink" href="#example-data" title="Permanent link">&para;</a></h3>
<p>For concreteness, we consider a fictitious set of "vanilla" molecular dynamics simulations, run with the <a href="https://openmm.org/">OpenMM</a> software. The following definitions set the dimensionality, periodicity, and the units for this simulation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">dimension</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">periodicity</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">time_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">picosecond</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">length_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">angstrom</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">energy_unit</span> <span class="o">=</span> <span class="mf">1000.</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">joule</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">mass_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">amu</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">charge_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">e</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">temperature_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">K</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">custom_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">newton</span> <span class="o">/</span> <span class="n">length_unit</span><span class="o">**</span><span class="mi">2</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">acceleration_unit</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">length_unit</span> <span class="o">/</span> <span class="n">time_unit</span><span class="o">**</span><span class="mi">2</span>
</code></pre></div>
<p>In this example, we will assume that the relevant simulation data is compatible with <a href="https://www.mdanalysis.org/">MDAnalysis</a>, such that a <strong>universe</strong> containing the trajectory and topology information can be created.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Knowledge of the MDAnalysis package is not necessary for understanding this example. The dimensions of the supplied quantities will be made clear in each case.</p>
</div>
<p>Create a universe by supplying a <code>pdb</code> structure file and corresponding <code>dcd</code> trajectory file (<a href="https://userguide.mdanalysis.org/stable/formats/index.html">MDAnalysis supports many different file formats</a>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">universe</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="s1">&#39;initial_structure.pdb&#39;</span><span class="p">,</span> <span class="s1">&#39;trajectory.dcd&#39;</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">n_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">n_atoms</span> <span class="o">=</span> <span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">n_atoms</span>
</code></pre></div>
Some topologies can be loaded directly into MDAnalysis. However, for simulations from OpenMM, one can read the topology using <code>parmed</code> and then import it to MDanalysis:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">pdb</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">PDBFile</span><span class="p">(</span><span class="s1">&#39;initial_structure.pdb&#39;</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">forcefield</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="s1">&#39;force_field.xml&#39;</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">system</span> <span class="o">=</span> <span class="n">forcefield</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">struct</span> <span class="o">=</span> <span class="n">chem</span><span class="o">.</span><span class="n">openmm</span><span class="o">.</span><span class="n">load_topology</span><span class="p">(</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">universe_toponly</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="h5md-group"><a href="../explanation-H5MD-NOMAD/#the-h5md-group">H5MD Group</a><a class="headerlink" href="#h5md-group" title="Permanent link">&para;</a></h3>
<p>Create an HDF5 file called <code>test_h5md-nomad.h5</code> and create the group <code>h5md</code> under <code>root</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">h5_write</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;test_h5md-nomad.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">h5md</span> <span class="o">=</span> <span class="n">h5_write</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;h5md&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Add the h5md version (1.0.x in this case) as an attribute of the <code>h5md</code> group:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">h5md</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div></p>
<p>Create the <code>author</code> group and add the associated metadata:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">author</span> <span class="o">=</span> <span class="n">h5md</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">author</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;author name&#39;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">author</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;author-name@example-domain.edu&#39;</span>
</code></pre></div></p>
<p>Create the <code>program</code> group and add the associated metadata:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">program</span> <span class="o">=</span> <span class="n">h5md</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;program&#39;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">program</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;OpenMM&#39;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">program</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;7.7.0&#39;</span>
</code></pre></div></p>
<p>Create the <code>creator</code> group and add the associated metadata:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">program</span> <span class="o">=</span> <span class="n">h5md</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;creator&#39;</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">program</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">program</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">h5py</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="particles-group"><a href="../explanation-H5MD-NOMAD/#the-particles-group">Particles Group</a><a class="headerlink" href="#particles-group" title="Permanent link">&para;</a></h3>
<p>Create the <code>particles</code> group and the underlying <code>all</code> group to hold the relevant particle data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">particles</span> <span class="o">=</span> <span class="n">h5_write</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;particles&#39;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">particles_group_all</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Get the steps, times, positions, and lattice vectors (i.e., box dimensions) from the MDA universe:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># quantities extracted from MDAnalysis</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">lattice_vectors</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="k">for</span> <span class="n">i_frame</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">universe</span><span class="o">.</span><span class="n">trajectory</span><span class="p">):</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="n">lattice_vectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">triclinic_dimensions</span><span class="p">)</span>
</code></pre></div></p>
<p>Set the positions and corresponding metadata:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">position_group_all</span> <span class="o">=</span> <span class="n">particles_group_all</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>  <span class="c1"># shape = (n_frames)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>  <span class="c1"># shape = (n_frames)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">positions</span>  <span class="c1"># shape = (n_frames, n_atoms, dimension)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">length_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="n">position_group_all</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length_unit</span><span class="o">.</span><span class="n">magnitude</span>
</code></pre></div></p>
<p>Set the particle-specific metadata:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;species_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">types</span>  <span class="c1"># shape = (n_atoms)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;force_field_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">names</span>  <span class="c1"># shape = (n_atoms)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">masses</span>  <span class="c1"># shape = (n_atoms)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mass_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">charges</span>  <span class="c1"># shape = (n_atoms)</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">charge_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">particles_group_all</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">charge_unit</span><span class="o">.</span><span class="n">magnitude</span>
</code></pre></div></p>
<!-- TODO - Should I say something about the species label here? Original code was:  [re.sub('[1-9]', '', atom_type) for atom_type in universe_toponly.atoms.types] -->

<p>Create the <code>box</code> group under <code>particles.all</code> and write corresponding data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">box_group</span> <span class="o">=</span> <span class="n">particles_group_all</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">box_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dimension&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dimension</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">box_group</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;boundary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">periodicity</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">edges</span> <span class="o">=</span> <span class="n">box_group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;edges&#39;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice_vectors</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">length_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="n">edges</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length_unit</span><span class="o">.</span><span class="n">magnitude</span>
</code></pre></div></p>
<h3 id="connectivity-group"><a href="../explanation-H5MD-NOMAD/#the-connectivity-group">Connectivity Group</a><a class="headerlink" href="#connectivity-group" title="Permanent link">&para;</a></h3>
<p>Create the <code>connectivity</code> group under <code>root</code> and add the tuples of bonds, angles, and dihedrals:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">connectivity</span> <span class="o">=</span> <span class="n">h5_write</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;connectivity&#39;</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">connectivity</span><span class="p">[</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">_bix</span>  <span class="c1"># shape = (n_bonds, 2)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">connectivity</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">angles</span><span class="o">.</span><span class="n">_bix</span>  <span class="c1"># shape = (n_angles, 3)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">connectivity</span><span class="p">[</span><span class="s1">&#39;dihedrals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">dihedrals</span><span class="o">.</span><span class="n">_bix</span>  <span class="c1"># shape = (n_dihedrals, 4)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">connectivity</span><span class="p">[</span><span class="s1">&#39;impropers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">impropers</span><span class="o">.</span><span class="n">_bix</span>  <span class="c1"># shape = (n_impropers, 4)</span>
</code></pre></div>
Here <code>n_bonds</code>, <code>n_angles</code>, <code>n_dihedrals</code>, and <code>n_impropers</code> represent the corresponding number of instances of each interaction within the force field.</p>
<p>You can read more about the creation of the hierarchical <code>particles_group</code> in <a href="#creating-a-topology-particles_group">Creating a topology</a>.</p>
<h3 id="observables-group"><a href="../explanation-H5MD-NOMAD/#the-observables-group">Observables Group</a><a class="headerlink" href="#observables-group" title="Permanent link">&para;</a></h3>
<p>For this section, we will consider sets of fabricated observable data for clarity. First, create the <code>observables</code> group under root:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">observables</span> <span class="o">=</span> <span class="n">h5_write</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;observables&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>There are 3 types of support observables:
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;configurational&#39;</span><span class="p">,</span> <span class="s1">&#39;ensemble_average&#39;</span><span class="p">,</span> <span class="s1">&#39;correlation_function&#39;</span><span class="p">]</span>
</code></pre></div></p>
<h4 id="configurational-observables"><a href="../explanation-H5MD-NOMAD/#configurational_observable_anchor">Configurational Observables</a><a class="headerlink" href="#configurational-observables" title="Permanent link">&para;</a></h4>
<p>Fabricated data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">temperatures</span> <span class="o">=</span> <span class="mf">300.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">potential_energies</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">kinetic_energies</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_frames</span><span class="p">)</span>
</code></pre></div></p>
<p>Create a <code>temperature</code> group and populate the associated metadata:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">temperature</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">temperature</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperatures</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temperature_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature_unit</span><span class="o">.</span><span class="n">magnitude</span>
</code></pre></div>
<p>Create an <code>energy</code> group to hold various types of energies. Add :
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">energies</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">potential_energy</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;potential&#39;</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">potential_energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_energies</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">energy_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="n">potential_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="n">kinetic_energy</span> <span class="o">=</span> <span class="n">energies</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;kinetic&#39;</span><span class="p">)</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="n">kinetic_energy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">energy_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="n">kinetic_energy</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_unit</span><span class="o">.</span><span class="n">magnitude</span>
</code></pre></div></p>
<h4 id="ensemble-average-observables"><a href="../explanation-H5MD-NOMAD/#ensemble_average_observable_anchor">Ensemble Average Observables</a><a class="headerlink" href="#ensemble-average-observables" title="Permanent link">&para;</a></h4>
<p>Fabricated data - the following represents radial distribution function (rdf) data calculated between molecule types <code>X</code> and <code>Y</code>, stored in <code>rdf_MOLX-MOLY.xvg</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>      0.24 0.000152428
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>     0.245 0.00457094
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>      0.25  0.0573499
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>     0.255   0.284764
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>      0.26   0.842825
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>     0.265    1.64705
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>      0.27    2.37243
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>     0.275    2.77916
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>      0.28    2.80622
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>     0.285    2.60082
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>      0.29    2.27182
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>      ...
</code></pre></div></p>
<p>Store the rdf data in a dictionary along with some relevant metadata:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">rdf_XX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;rdf_MOLX-MOLX.xvg&#39;</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">rdf_XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;rdf_MOLX-MOLY.xvg&#39;</span><span class="p">)</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">rdf_YY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;rdf_MOLY-MOLY.xvg&#39;</span><span class="p">)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">rdfs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="s1">&#39;MOLX-MOLX&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="s1">&#39;n_bins&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdf_XX</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>        <span class="s1">&#39;bins&#39;</span><span class="p">:</span> <span class="n">rdf_XX</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">rdf_XX</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular&#39;</span><span class="p">,</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="s1">&#39;frame_start&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>        <span class="s1">&#39;frame_end&#39;</span><span class="p">:</span> <span class="n">n_frames</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="p">},</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>    <span class="s1">&#39;MOLX-MOLY&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="s1">&#39;n_bins&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdf_XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="s1">&#39;bins&#39;</span><span class="p">:</span> <span class="n">rdf_XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">rdf_XY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular&#39;</span><span class="p">,</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="s1">&#39;frame_start&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>        <span class="s1">&#39;frame_end&#39;</span><span class="p">:</span> <span class="n">n_frames</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>    <span class="p">},</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>    <span class="s1">&#39;MOLY-MOLY&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>        <span class="s1">&#39;n_bins&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdf_YY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>        <span class="s1">&#39;bins&#39;</span><span class="p">:</span> <span class="n">rdf_YY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">rdf_YY</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular&#39;</span><span class="p">,</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>        <span class="s1">&#39;frame_start&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>        <span class="s1">&#39;frame_end&#39;</span><span class="p">:</span> <span class="n">n_frames</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>    <span class="p">}</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="p">}</span>
</code></pre></div>
<p>Now create the <code>radial_distribution_functions</code> group under <code>observables</code> and store each imported rdf:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">radial_distribution_functions</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;radial_distribution_functions&#39;</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rdfs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="n">rdf</span> <span class="o">=</span> <span class="n">radial_distribution_functions</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="n">rdf</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;n_bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;n_bins&#39;</span><span class="p">]</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">length_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;frame_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frame_start&#39;</span><span class="p">]</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    <span class="n">rdf</span><span class="p">[</span><span class="s1">&#39;frame_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdfs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frame_end&#39;</span><span class="p">]</span>
</code></pre></div></p>
<p>We can also store scalar ensemble average observables. Let's consider some fabricated diffusion constant data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">Ds</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="s1">&#39;MOLX&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>        <span class="s1">&#39;error_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Pearson_correlation_coefficient&#39;</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mf">0.98</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="p">},</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="s1">&#39;MOLY&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="s1">&#39;error_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Pearson_correlation_coefficient&#39;</span><span class="p">,</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="mf">0.95</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="p">}</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="p">}</span>
</code></pre></div></p>
<p>Create the <code>diffusion constants</code> group under <code>observables</code> and store the correspond (meta)data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">diffusion_constants</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;diffusion_constants&#39;</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Ds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">diffusion_constant</span> <span class="o">=</span> <span class="n">diffusion_constants</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="n">diffusion_constant</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="n">diffusion_constant</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">diffusion_constant</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">diff_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    <span class="n">diffusion_constant</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diff_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="n">diffusion_constant</span><span class="p">[</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    <span class="n">diffusion_constant</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
</code></pre></div>
<h4 id="time-correlation-observables"><a href="../explanation-H5MD-NOMAD/#time_correlation_observable_anchor">Time Correlation Observables</a><a class="headerlink" href="#time-correlation-observables" title="Permanent link">&para;</a></h4>
<p>Fabricated data - the following represents mean squared displacement (msd) data calculated for molecule type <code>X</code>, stored in <code>msd_MOLX.xvg</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>         0           0
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>         2   0.0688769
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>         4    0.135904
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>         6    0.203573
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>         8    0.271162
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>        10    0.339284
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>        12    0.410115
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>        14    0.477376
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>        16    0.545184
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>        18     0.61283
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>        ...
</code></pre></div></p>
<p>Store the msd data in a dictionary along with some relevant metadata:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">msd_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;msd_MOLX.xvg&#39;</span><span class="p">)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">msd_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;msd_MOLY.xvg&#39;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">msds</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="s1">&#39;MOLX&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>        <span class="s1">&#39;n_times&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">msd_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>        <span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="n">msd_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">msd_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular&#39;</span><span class="p">,</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>        <span class="s1">&#39;direction&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>        <span class="s1">&#39;error_type&#39;</span><span class="p">:</span> <span class="s1">&#39;standard_deviation&#39;</span><span class="p">,</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>        <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msd_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>    <span class="p">},</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>    <span class="s1">&#39;MOLY&#39;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>        <span class="s1">&#39;n_times&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">msd_Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>        <span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="n">msd_Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">msd_Y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;molecular&#39;</span><span class="p">,</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>        <span class="s1">&#39;direction&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>        <span class="s1">&#39;error_type&#39;</span><span class="p">:</span> <span class="s1">&#39;standard_deviation&#39;</span><span class="p">,</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>        <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msd_Y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])),</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>    <span class="p">}</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="p">}</span>
</code></pre></div>
<p>Now create the <code>mean_squared_displacements</code> group under <code>observables</code> and store each imported rdf:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">mean_squared_displacements</span> <span class="o">=</span> <span class="n">observables</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;mean_squared_displacements&#39;</span><span class="p">)</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">msd_unit</span> <span class="o">=</span> <span class="n">length_unit</span> <span class="o">*</span> <span class="n">length_unit</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">diff_unit</span> <span class="o">=</span> <span class="n">msd_unit</span> <span class="o">/</span> <span class="n">time_unit</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">msds</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">msd</span> <span class="o">=</span> <span class="n">mean_squared_displacements</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="n">msd</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;error_type&#39;</span><span class="p">]</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;n_times&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;n_times&#39;</span><span class="p">]</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msd_unit</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msd_unit</span><span class="o">.</span><span class="n">magnitude</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>    <span class="n">msd</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msds</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span>
</code></pre></div>
<h3 id="parameter-group"><a href="../explanation-H5MD-NOMAD/#the-parameters-group">Parameter Group</a><a class="headerlink" href="#parameter-group" title="Permanent link">&para;</a></h3>
<p>Using the json templates for <a href="../parameters/#force_calculation_template_anchor">force calculations</a> and <a href="../explanation-H5MD-NOMAD/#md_workflow_template_anchor">molecular dynamics workflows</a>, the (meta)data can be written to the H5MD-NOMAD file using the following code:</p>
<p>First, import the data extracted from the JSON templates:
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;force_calculations_metainfo.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="n">force_calculation_parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;workflow_metainfo.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="n">workflow_parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</code></pre></div></p>
<p>Then, create the appropriate container groups:
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">parameters</span> <span class="o">=</span> <span class="n">h5_write</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">force_calculations</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;force_calculations&#39;</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">workflow</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;workflow&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Now, recursively write the (meta)data:
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span> <span class="nf">get_parameters_recursive</span><span class="p">(</span><span class="n">parameter_group</span><span class="p">,</span> <span class="n">parameter_dict</span><span class="p">):</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="c1"># Store the parameters from parameter dict into an hdf5 file</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parameter_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>            <span class="n">param</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>            <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>                <span class="n">parameter_group</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>                <span class="n">unit</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>                <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>                    <span class="n">parameter_group</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># This is a subsection</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>                <span class="n">subsection</span> <span class="o">=</span> <span class="n">parameter_group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>                <span class="n">subsection</span> <span class="o">=</span> <span class="n">get_parameters_recursive</span><span class="p">(</span><span class="n">subsection</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>                <span class="n">parameter_group</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>    <span class="k">return</span> <span class="n">parameter_group</span>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="n">force_calculations</span> <span class="o">=</span> <span class="n">get_parameters_recursive</span><span class="p">(</span><span class="n">force_calculations</span><span class="p">,</span> <span class="n">force_calculation_parameters</span><span class="p">)</span>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="n">workflow</span> <span class="o">=</span> <span class="n">get_parameters_recursive</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">workflow_parameters</span><span class="p">)</span>
</code></pre></div></p>
<p>It's as simple as that! Now, we can <a href="../../../uploading_and_publishing/overview/">upload our H5MD-NOMAD file directly to NOMAD</a> and all the written (meta)data will be stored according to the standard NOMAD schema.</p>
<h2 id="accessing-an-h5md-nomad-file">Accessing an H5MD-NOMAD file<a class="headerlink" href="#accessing-an-h5md-nomad-file" title="Permanent link">&para;</a></h2>
<p>The following functions are useful for accessing data from your H5MD-NOMAD file:
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">def</span> <span class="nf">apply_unit</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">unit_factor</span><span class="p">):</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>    <span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="k">if</span> <span class="n">quantity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>        <span class="k">return</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>        <span class="n">unit</span> <span class="o">=</span> <span class="n">ureg</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>        <span class="n">unit</span> <span class="o">*=</span> <span class="n">unit_factor</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>        <span class="n">quantity</span> <span class="o">*=</span> <span class="n">unit</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="k">return</span> <span class="n">quantity</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="k">def</span> <span class="nf">decode_hdf5_bytes</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>    <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>        <span class="k">return</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">:</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>        <span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="p">[]:</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>            <span class="k">return</span> <span class="n">dataset</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">])</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="n">dataset</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span> <span class="k">else</span> <span class="n">dataset</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>    <span class="k">return</span> <span class="n">dataset</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="k">def</span> <span class="nf">hdf5_attr_getter</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="sd">    Extracts attribute from object based on path, and returns default if not defined.</span>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>    <span class="n">section_segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_segments</span><span class="p">:</span>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>            <span class="n">source</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>            <span class="k">return</span>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">decode_hdf5_bytes</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default</span>
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a>    <span class="k">return</span> <span class="n">source</span>
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a>
<a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a><span class="k">def</span> <span class="nf">hdf5_getter</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a><span class="sd">    Extracts attribute from object based on path, and returns default if not defined.</span>
<a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a>    <span class="n">section_segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a>    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_segments</span><span class="p">:</span>
<a id="__codelineno-31-47" name="__codelineno-31-47" href="#__codelineno-31-47"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-31-48" name="__codelineno-31-48" href="#__codelineno-31-48"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
<a id="__codelineno-31-49" name="__codelineno-31-49" href="#__codelineno-31-49"></a>            <span class="n">unit</span> <span class="o">=</span> <span class="n">hdf5_attr_getter</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">)</span>
<a id="__codelineno-31-50" name="__codelineno-31-50" href="#__codelineno-31-50"></a>            <span class="n">unit_factor</span> <span class="o">=</span> <span class="n">hdf5_attr_getter</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="s1">&#39;unit_factor&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<a id="__codelineno-31-51" name="__codelineno-31-51" href="#__codelineno-31-51"></a>            <span class="n">source</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
<a id="__codelineno-31-52" name="__codelineno-31-52" href="#__codelineno-31-52"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-31-53" name="__codelineno-31-53" href="#__codelineno-31-53"></a>            <span class="k">return</span>
<a id="__codelineno-31-54" name="__codelineno-31-54" href="#__codelineno-31-54"></a>
<a id="__codelineno-31-55" name="__codelineno-31-55" href="#__codelineno-31-55"></a>    <span class="k">if</span> <span class="n">source</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-31-56" name="__codelineno-31-56" href="#__codelineno-31-56"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">default</span>
<a id="__codelineno-31-57" name="__codelineno-31-57" href="#__codelineno-31-57"></a>    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<a id="__codelineno-31-58" name="__codelineno-31-58" href="#__codelineno-31-58"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">[()]</span>
<a id="__codelineno-31-59" name="__codelineno-31-59" href="#__codelineno-31-59"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">apply_unit</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">unit_factor</span><span class="p">)</span>
<a id="__codelineno-31-60" name="__codelineno-31-60" href="#__codelineno-31-60"></a>
<a id="__codelineno-31-61" name="__codelineno-31-61" href="#__codelineno-31-61"></a>    <span class="k">return</span> <span class="n">decode_hdf5_bytes</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</code></pre></div></p>
<p>Open your H5MD-NOMAD file with <code>h5py</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">import</span> <span class="nn">h5py</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">h5_read</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;test_h5md-nomad.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</code></pre></div></p>
<p>Access a particular data set:
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">potential_energies</span> <span class="o">=</span> <span class="n">h5_read</span><span class="p">[</span><span class="s1">&#39;observables&#39;</span><span class="p">][</span><span class="s1">&#39;energy&#39;</span><span class="p">][</span><span class="s1">&#39;potential&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">potential_energies</span><span class="p">[()])</span>
</code></pre></div>
result:
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>array([1., 1., 1., 1., 1.])
</code></pre></div></p>
<p>Get the unit information for this quantity:
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">unit</span> <span class="o">=</span> <span class="n">potential_energies</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">unit_factor</span> <span class="o">=</span> <span class="n">potential_energies</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit_factor&#39;</span><span class="p">]</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="nb">print</span><span class="p">(</span><span class="n">unit_factor</span><span class="p">)</span>
</code></pre></div></p>
<p>results:
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>joule
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>1000.0
</code></pre></div></p>
<p>Alternatively, the above functions will return the dataset as python arrays, i.e., already applying <code>[()]</code> to the HDF5 element, and also apply the appropriate units where applicable:
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">potential_energies</span> <span class="o">=</span> <span class="n">hdf5_getter</span><span class="p">(</span><span class="n">h5_read</span><span class="p">,</span> <span class="s1">&#39;observables.energy.potential.value&#39;</span><span class="p">)</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">potential_energies</span><span class="p">)</span>
</code></pre></div></p>
<p>result:
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>Magnitude
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>[1000.0 1000.0 1000.0 1000.0 1000.0]
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Units   joule
</code></pre></div></p>
<!-- TODO Separate topology creation and put into the general docs -->
<h2 id="creating-a-topology-particles_group">Creating a topology (<code>particles_group</code>)<a class="headerlink" href="#creating-a-topology-particles_group" title="Permanent link">&para;</a></h2>
<p>This page demonstrates how to create a "standard" topology in H5MD-NOMAD. The demonstrated organization of molecules and monomers is identical to what other NOMAD parsers do to create a topology from native simulation files (e.g., outputs from <a href="https://www.gromacs.org/">GROMACS</a> or <a href="https://www.lammps.org">LAMMPS</a>). However, the user is free to deviate from this standard to create arbitrary organizations of particles, as described in <a href="../explanation-H5MD-NOMAD/#the-connectivity-group">Connectivity</a>.</p>
<!-- TODO add hrefs to "writing a parser plugin" section when you say "NOMAD parsers" -->

<h3 id="standard-topology-structure-for-bonded-force-fields">Standard topology structure for bonded force fields<a class="headerlink" href="#standard-topology-structure-for-bonded-force-fields" title="Permanent link">&para;</a></h3>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>topology
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a> molecule_group_1
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>    molecule_1
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>        monomer_group_1
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>               monomer_1
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>                         metadata for monomer_1
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>                  monomer_2
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>                         metadata for monomer_2
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>                  ...
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>        monomer_group_2
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>          ...
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>    molecule_2
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>        ...
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>    ...
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a> molecule_group_2
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a>    molecule_1
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a>        metadata for molecule_1
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a>    molecule_2
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>        metadata for molecule_2
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>          ...
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a>    ...
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a> ...
</code></pre></div>
Here, the first level of organization is the "molecule group". Molecule groups contain molecules of the same type. In other words, <code>molecule_group_1</code> and <code>molecule_group_2</code> represent distinct molecule types. At the next level of the hierarchy, each molecule within this group is stored (i.e., <code>molecule_1</code>, <code>molecule_2</code>, etc.). In the above example, <code>molecule_group_1</code> represents a polymer (or protein). Thus, below the molecule level, there is a "monomer group level". Similar to the molecule group, the monomer group organizes all monomers (of the parent molecule) that are of the same type. Thus, for <code>molecule_1</code> of <code>molecule_group_1</code>, <code>monomer_group_1</code> and <code>monomer_group_2</code> represent distinct types of monomers existing within the polymer. Then, below <code>monomer_group_1</code>, each monomer within this group is stored. Finally, beneath these individual monomers, only the metadata for that monomer is stored (i.e., no further organization levels). Note however, that metadata can be (and is) stored at each level of the hierarchy, but is left out of the illustration for clarity. Notice also that <code>molecule_group_2</code> is not a polymer. Thus, each molecule within this group stores only the corresponding metadata, and no further levels of organization.</p>
<!-- TODO - add image of topology bar in overview page? Here or maybe when the topology is introduced on the connectivity page?
add full explanation and reference about what Topology/Groups mean in NOMAD -->

<h3 id="creating-the-standard-hierarchy-from-an-mdanalysis-universe">Creating the standard hierarchy from an MDAnalysis universe<a class="headerlink" href="#creating-the-standard-hierarchy-from-an-mdanalysis-universe" title="Permanent link">&para;</a></h3>
<p>We start from the perspective of the <a href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python">Writing an HDF5 file according to H5MD-NOMAD with python</a> section, with identical imports and assuming that an MDAnalysis <code>universe</code> is already instantiated from the raw simulation files. As in the previous example, the <code>universe</code> containing the topology information is called <code>universe_topology</code>.</p>
<p>The following functions will be useful for creating the topology:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">def</span> <span class="nf">get_composition</span><span class="p">(</span><span class="n">children_names</span><span class="p">):</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="sd">    Given a list of children, return a compositional formula as a function of</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="sd">    these children. The format is &lt;child_1&gt;(n_child_1)&lt;child_2&gt;(n_child_2)...</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="n">children_count_tup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">children_names</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>    <span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">)&#39;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">children_count_tup</span><span class="p">)])</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="k">return</span> <span class="n">formula</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="k">def</span> <span class="nf">get_molecules_from_bond_list</span><span class="p">(</span><span class="n">n_particles</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">particle_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">particles_typeid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="sd">    Returns a dictionary with molecule info from the list of bonds</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a>    <span class="kn">import</span> <span class="nn">networkx</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a>    <span class="n">system_graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">empty_graph</span><span class="p">(</span><span class="n">n_particles</span><span class="p">)</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a>    <span class="n">system_graph</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bond_list</span><span class="p">])</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a>    <span class="n">molecules</span> <span class="o">=</span> <span class="p">[</span><span class="n">system_graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">networkx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">system_graph</span><span class="p">)]</span>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a>    <span class="n">mol_dict</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a>    <span class="k">for</span> <span class="n">i_mol</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">molecules</span><span class="p">):</span>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a>        <span class="n">mol_dict</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a>        <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a>        <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a>        <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;molecule&#39;</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a>        <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a>        <span class="k">if</span> <span class="n">particles_typeid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">particle_types</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_particles</span><span class="p">:</span>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a>            <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">particle_types</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]))]</span>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a>        <span class="k">if</span> <span class="n">particle_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">particles_typeid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a>            <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">particle_types</span><span class="p">[</span><span class="n">particles_typeid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]))]</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a>        <span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_composition</span><span class="p">(</span><span class="n">mol_dict</span><span class="p">[</span><span class="n">i_mol</span><span class="p">][</span><span class="s1">&#39;names&#39;</span><span class="p">])</span>
<a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a>
<a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a>    <span class="k">return</span> <span class="n">mol_dict</span>
<a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a>
<a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a>
<a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="k">def</span> <span class="nf">is_same_molecule</span><span class="p">(</span><span class="n">mol_1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">mol_2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="sd">    Checks whether the 2 input molecule dictionaries represent the same</span>
<a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a><span class="sd">    molecule type, i.e., same particle types and corresponding bond connections.</span>
<a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a>
<a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a>    <span class="k">if</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mol_1</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mol_2</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]):</span>
<a id="__codelineno-40-44" name="__codelineno-40-44" href="#__codelineno-40-44"></a>        <span class="n">mol_1_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mol_1</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">])</span>
<a id="__codelineno-40-45" name="__codelineno-40-45" href="#__codelineno-40-45"></a>        <span class="n">mol_2_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mol_2</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">])</span>
<a id="__codelineno-40-46" name="__codelineno-40-46" href="#__codelineno-40-46"></a>        <span class="n">mol_1_bonds_shift</span> <span class="o">=</span> <span class="n">mol_1</span><span class="p">[</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mol_1_shift</span>
<a id="__codelineno-40-47" name="__codelineno-40-47" href="#__codelineno-40-47"></a>        <span class="n">mol_2_bonds_shift</span> <span class="o">=</span> <span class="n">mol_2</span><span class="p">[</span><span class="s1">&#39;bonds&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mol_2_shift</span>
<a id="__codelineno-40-48" name="__codelineno-40-48" href="#__codelineno-40-48"></a>
<a id="__codelineno-40-49" name="__codelineno-40-49" href="#__codelineno-40-49"></a>        <span class="n">bond_list_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">((</span><span class="n">mol_1</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">mol_1</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">mol_1_bonds_shift</span><span class="p">]</span>
<a id="__codelineno-40-50" name="__codelineno-40-50" href="#__codelineno-40-50"></a>        <span class="n">bond_list_2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sorted</span><span class="p">((</span><span class="n">mol_2</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">mol_2</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">mol_2_bonds_shift</span><span class="p">]</span>
<a id="__codelineno-40-51" name="__codelineno-40-51" href="#__codelineno-40-51"></a>
<a id="__codelineno-40-52" name="__codelineno-40-52" href="#__codelineno-40-52"></a>        <span class="n">bond_list_names_1</span><span class="p">,</span> <span class="n">bond_list_counts_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">bond_list_1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-40-53" name="__codelineno-40-53" href="#__codelineno-40-53"></a>        <span class="n">bond_list_names_2</span><span class="p">,</span> <span class="n">bond_list_counts_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">bond_list_2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-40-54" name="__codelineno-40-54" href="#__codelineno-40-54"></a>
<a id="__codelineno-40-55" name="__codelineno-40-55" href="#__codelineno-40-55"></a>        <span class="n">bond_list_dict_1</span> <span class="o">=</span> <span class="p">{</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bond_list_counts_1</span><span class="p">[</span><span class="n">i_bond</span><span class="p">]</span> <span class="k">for</span> <span class="n">i_bond</span><span class="p">,</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bond_list_names_1</span><span class="p">)}</span>
<a id="__codelineno-40-56" name="__codelineno-40-56" href="#__codelineno-40-56"></a>        <span class="n">bond_list_dict_2</span> <span class="o">=</span> <span class="p">{</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">bond_list_counts_2</span><span class="p">[</span><span class="n">i_bond</span><span class="p">]</span> <span class="k">for</span> <span class="n">i_bond</span><span class="p">,</span> <span class="n">bond</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bond_list_names_2</span><span class="p">)}</span>
<a id="__codelineno-40-57" name="__codelineno-40-57" href="#__codelineno-40-57"></a>        <span class="k">if</span> <span class="n">bond_list_dict_1</span> <span class="o">==</span> <span class="n">bond_list_dict_2</span><span class="p">:</span>
<a id="__codelineno-40-58" name="__codelineno-40-58" href="#__codelineno-40-58"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-40-59" name="__codelineno-40-59" href="#__codelineno-40-59"></a>
<a id="__codelineno-40-60" name="__codelineno-40-60" href="#__codelineno-40-60"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-40-61" name="__codelineno-40-61" href="#__codelineno-40-61"></a>
<a id="__codelineno-40-62" name="__codelineno-40-62" href="#__codelineno-40-62"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
<p>Then, we can create the topology structure from the MDAnalysis universe:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">bond_list</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">bonds</span><span class="o">.</span><span class="n">_bix</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">molecules</span> <span class="o">=</span> <span class="n">get_molecules_from_bond_list</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">bond_list</span><span class="p">,</span> <span class="n">particle_types</span><span class="o">=</span><span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">types</span><span class="p">,</span> <span class="n">particles_typeid</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="c1"># create the topology</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="n">mol_groups</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="n">mol_groups</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="n">mol_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="n">mol_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">molecules</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="n">mol_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;molecule_group&#39;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="n">mol_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    <span class="n">flag_mol_group_exists</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>    <span class="k">for</span> <span class="n">i_mol_group</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol_groups</span><span class="p">)):</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>        <span class="k">if</span> <span class="n">is_same_molecule</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">mol_groups</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>            <span class="n">mol_groups</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>            <span class="n">flag_mol_group_exists</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>            <span class="k">break</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_mol_group_exists</span><span class="p">:</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>        <span class="n">mol_groups</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>        <span class="n">mol_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>        <span class="n">mol_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;molecules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a>        <span class="n">mol_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;molecule_group&#39;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>        <span class="n">mol_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="k">for</span> <span class="n">i_mol_group</span><span class="p">,</span> <span class="n">mol_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol_groups</span><span class="p">):</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a>    <span class="n">mol_groups</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule_labels</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol_group</span><span class="p">[</span><span class="s1">&#39;molecules&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a>    <span class="n">mol_groups</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">molecule_labels</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">])</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a>    <span class="n">mol_group_indices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a>    <span class="k">for</span> <span class="n">i_molecule</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol_group</span><span class="p">[</span><span class="s1">&#39;molecules&#39;</span><span class="p">]):</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a>        <span class="n">molecule</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule_labels</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">]</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a>        <span class="n">mol_indices</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>        <span class="n">mol_group_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mol_indices</span><span class="p">)</span>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a>        <span class="n">mol_resids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">resindices</span><span class="p">[</span><span class="n">mol_indices</span><span class="p">])</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a>        <span class="k">if</span> <span class="n">mol_resids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a>            <span class="k">continue</span>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a>        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a>        <span class="k">for</span> <span class="n">i_resid</span><span class="p">,</span> <span class="n">resid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol_resids</span><span class="p">):</span>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a>            <span class="n">res_dict</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">resindices</span><span class="p">[</span><span class="n">mol_indices</span><span class="p">]</span> <span class="o">==</span> <span class="n">resid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">resnames</span><span class="p">[</span><span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_composition</span><span class="p">(</span><span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;indices&#39;</span><span class="p">]])</span>
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">i_resid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;monomer&#39;</span>
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a>
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a>        <span class="n">res_groups</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a>        <span class="n">res_groups</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a>        <span class="n">res_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;residues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a>        <span class="n">res_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;residues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a>        <span class="n">res_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group_&#39;</span> <span class="o">+</span> <span class="n">res_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
<a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a>        <span class="n">res_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;monomer_group&#39;</span>
<a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a>        <span class="n">res_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a>        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a>            <span class="n">flag_res_group_exists</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a>            <span class="k">for</span> <span class="n">i_res_group</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res_groups</span><span class="p">)):</span>
<a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a>                <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">res_groups</span><span class="p">[</span><span class="n">i_res_group</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]:</span>
<a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a>                    <span class="n">res_groups</span><span class="p">[</span><span class="n">i_res_group</span><span class="p">][</span><span class="s1">&#39;residues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a>                    <span class="n">flag_res_group_exists</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a>                    <span class="k">break</span>
<a id="__codelineno-41-61" name="__codelineno-41-61" href="#__codelineno-41-61"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_res_group_exists</span><span class="p">:</span>
<a id="__codelineno-41-62" name="__codelineno-41-62" href="#__codelineno-41-62"></a>                <span class="n">res_groups</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
<a id="__codelineno-41-63" name="__codelineno-41-63" href="#__codelineno-41-63"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;residues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-64" name="__codelineno-41-64" href="#__codelineno-41-64"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;residues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-41-65" name="__codelineno-41-65" href="#__codelineno-41-65"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;group_&#39;</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
<a id="__codelineno-41-66" name="__codelineno-41-66" href="#__codelineno-41-66"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_composition</span><span class="p">(</span><span class="n">universe_toponly</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]])</span>
<a id="__codelineno-41-67" name="__codelineno-41-67" href="#__codelineno-41-67"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;monomer_group&#39;</span>
<a id="__codelineno-41-68" name="__codelineno-41-68" href="#__codelineno-41-68"></a>                <span class="n">res_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;is_molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-41-69" name="__codelineno-41-69" href="#__codelineno-41-69"></a>
<a id="__codelineno-41-70" name="__codelineno-41-70" href="#__codelineno-41-70"></a>        <span class="n">molecule</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-41-71" name="__codelineno-41-71" href="#__codelineno-41-71"></a>        <span class="k">for</span> <span class="n">res_group</span> <span class="ow">in</span> <span class="n">res_groups</span><span class="p">:</span>
<a id="__codelineno-41-72" name="__codelineno-41-72" href="#__codelineno-41-72"></a>            <span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;residues&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;residues&#39;</span><span class="p">]))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<a id="__codelineno-41-73" name="__codelineno-41-73" href="#__codelineno-41-73"></a>            <span class="n">molecule</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;formula&#39;</span><span class="p">]</span>
<a id="__codelineno-41-74" name="__codelineno-41-74" href="#__codelineno-41-74"></a>            <span class="n">res_group_indices</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-41-75" name="__codelineno-41-75" href="#__codelineno-41-75"></a>            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;residues&#39;</span><span class="p">]:</span>
<a id="__codelineno-41-76" name="__codelineno-41-76" href="#__codelineno-41-76"></a>                <span class="n">res_group_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">])</span>
<a id="__codelineno-41-77" name="__codelineno-41-77" href="#__codelineno-41-77"></a>            <span class="n">res_group</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">res_group_indices</span><span class="p">)</span>
<a id="__codelineno-41-78" name="__codelineno-41-78" href="#__codelineno-41-78"></a>
<a id="__codelineno-41-79" name="__codelineno-41-79" href="#__codelineno-41-79"></a>        <span class="n">mol_group</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">mol_group_indices</span><span class="p">)</span>
<a id="__codelineno-41-80" name="__codelineno-41-80" href="#__codelineno-41-80"></a>
<a id="__codelineno-41-81" name="__codelineno-41-81" href="#__codelineno-41-81"></a>        <span class="n">molecule</span><span class="p">[</span><span class="s1">&#39;residue_groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_groups</span>
</code></pre></div>
<h3 id="writing-the-topology-to-an-h5md-nomad-file">Writing the topology to an H5MD-NOMAD file<a class="headerlink" href="#writing-the-topology-to-an-h5md-nomad-file" title="Permanent link">&para;</a></h3>
<p>Here we assume an H5MD-NOMAD file has already been created, as demonstrated on the <a href="#writing-an-hdf5-file-according-to-h5md-nomad-with-python">Writing an HDF5 file according to H5MD-NOMAD with python</a> section, and that the <code>connectivity</code> group was created under the root level.</p>
<p>Now, create the <code>particles_group</code> group under <code>connectivity</code> within our HDF5-NOMAD file:
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">topology_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;formula&#39;</span><span class="p">,</span> <span class="s1">&#39;particles_group&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;is_molecule&#39;</span><span class="p">,</span> <span class="s1">&#39;indices&#39;</span><span class="p">]</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">custom_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;molecules&#39;</span><span class="p">,</span> <span class="s1">&#39;residue_groups&#39;</span><span class="p">,</span> <span class="s1">&#39;residues&#39;</span><span class="p">]</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">topology</span> <span class="o">=</span> <span class="n">connectivity</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;particles_group&#39;</span><span class="p">)</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="k">for</span> <span class="n">i_mol_group</span><span class="p">,</span> <span class="n">mol_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol_groups</span><span class="p">):</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>    <span class="n">hdf5_mol_group</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;group_&#39;</span> <span class="o">+</span> <span class="n">molecule_labels</span><span class="p">[</span><span class="n">i_mol_group</span><span class="p">])</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>    <span class="k">for</span> <span class="n">mol_group_key</span> <span class="ow">in</span> <span class="n">mol_group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>        <span class="k">if</span> <span class="n">mol_group_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topology_keys</span> <span class="o">+</span> <span class="n">custom_keys</span><span class="p">:</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>            <span class="k">continue</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>        <span class="k">if</span> <span class="n">mol_group_key</span> <span class="o">!=</span> <span class="s1">&#39;molecules&#39;</span><span class="p">:</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>            <span class="n">hdf5_mol_group</span><span class="p">[</span><span class="n">mol_group_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol_group</span><span class="p">[</span><span class="n">mol_group_key</span><span class="p">]</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>            <span class="n">hdf5_molecules</span> <span class="o">=</span> <span class="n">hdf5_mol_group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;particles_group&#39;</span><span class="p">)</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>            <span class="k">for</span> <span class="n">i_molecule</span><span class="p">,</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol_group</span><span class="p">[</span><span class="n">mol_group_key</span><span class="p">]):</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>                <span class="n">hdf5_mol</span> <span class="o">=</span> <span class="n">hdf5_molecules</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;molecule_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_molecule</span><span class="p">))</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>                <span class="k">for</span> <span class="n">mol_key</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>                    <span class="k">if</span> <span class="n">mol_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topology_keys</span> <span class="o">+</span> <span class="n">custom_keys</span><span class="p">:</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>                        <span class="k">continue</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>                    <span class="k">if</span> <span class="n">mol_key</span> <span class="o">!=</span> <span class="s1">&#39;residue_groups&#39;</span><span class="p">:</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>                        <span class="n">hdf5_mol</span><span class="p">[</span><span class="n">mol_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">molecule</span><span class="p">[</span><span class="n">mol_key</span><span class="p">]</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>                        <span class="n">hdf5_residue_groups</span> <span class="o">=</span> <span class="n">hdf5_mol</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;particles_group&#39;</span><span class="p">)</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>                        <span class="k">for</span> <span class="n">i_res_group</span><span class="p">,</span> <span class="n">res_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">molecule</span><span class="p">[</span><span class="n">mol_key</span><span class="p">]):</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>                            <span class="n">hdf5_res_group</span> <span class="o">=</span> <span class="n">hdf5_residue_groups</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;residue_group_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_res_group</span><span class="p">))</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>                            <span class="k">for</span> <span class="n">res_group_key</span> <span class="ow">in</span> <span class="n">res_group</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>                                <span class="k">if</span> <span class="n">res_group_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topology_keys</span> <span class="o">+</span> <span class="n">custom_keys</span><span class="p">:</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>                                    <span class="k">continue</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>                                <span class="k">if</span> <span class="n">res_group_key</span> <span class="o">!=</span> <span class="s1">&#39;residues&#39;</span><span class="p">:</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a>                                    <span class="n">hdf5_res_group</span><span class="p">[</span><span class="n">res_group_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_group</span><span class="p">[</span><span class="n">res_group_key</span><span class="p">]</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a>                                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>                                    <span class="n">hdf5_residues</span> <span class="o">=</span> <span class="n">hdf5_res_group</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;particles_group&#39;</span><span class="p">)</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a>                                    <span class="k">for</span> <span class="n">i_res</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">res_group</span><span class="p">[</span><span class="n">res_group_key</span><span class="p">]):</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>                                        <span class="n">hdf5_res</span> <span class="o">=</span> <span class="n">hdf5_residues</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;residue_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_res</span><span class="p">))</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a>                                        <span class="k">for</span> <span class="n">res_key</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>                                            <span class="k">if</span> <span class="n">res_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topology_keys</span><span class="p">:</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>                                                <span class="k">continue</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>                                            <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="n">res_key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>                                                <span class="n">hdf5_res</span><span class="p">[</span><span class="n">res_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">res_key</span><span class="p">]</span>
</code></pre></div></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../overview/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Overview
              </div>
            </div>
          </a>
        
        
          
          <a href="../explanation-H5MD-NOMAD/" class="md-footer__link md-footer__link--next" aria-label="Next: Explanation - File structure and schema" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Explanation - File structure and schema
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 0.1}</script>
    
    
      <script src="../../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
      
        <script src="https://unpkg.com/cytoscape@3.19.1/dist/cytoscape.min.js"></script>
      
    
  </body>
</html>